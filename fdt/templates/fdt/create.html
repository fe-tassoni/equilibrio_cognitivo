{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Novo Resultado FDT - Equilíbrio Cognitivo{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10"> <!-- Aumentei a largura para a tabela caber confortavelmente -->
        <div class="card fade-in">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i>Novo Resultado FDT</h4>
            </div>
            <div class="card-body p-4">
                <form method="post" novalidate>
                    {% csrf_token %}

                    <!-- CAMPOS GERAIS -->
                    <div class="row mb-3">
                        <div class="col-md-8">{{ form.paciente|as_crispy_field }}</div>
                        <div class="col-md-4">{{ form.data_resultado|as_crispy_field }}</div>
                    </div>
                    <!-- TABELAS DE RESULTADOS -->

                    <!-- Processos Automáticos e Controlados (Tempo) -->
                    <h5 class="mb-3 fw-normal">Processos Automáticos e Controlados</h5>
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 25%;">Etapa</th>
                                    <th style="width: 25%;">Tempo (s)</th>
                                    <th style="width: 25%;">Percentil</th>
                                    <th style="width: 25%;">Classificação</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Leitura</td>
                                    <td>{{ form.tempo_leitura }}</td>
                                    <td><span id="leitura_tempo_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="leitura_tempo_class" class="text-muted fst-italic"></span></td>
                                </tr>
                                <tr>
                                    <td>Contagem</td>
                                    <td>{{ form.tempo_contagem }}</td>
                                    <td><span id="contagem_tempo_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="contagem_tempo_class" class="text-muted fst-italic"></span></td>
                                </tr>
                                <tr>
                                    <td>Escolha</td>
                                    <td>{{ form.tempo_escolha }}</td>
                                    <td><span id="escolha_tempo_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="escolha_tempo_class" class="text-muted fst-italic"></span></td>
                                </tr>
                                <tr>
                                    <td>Alternância</td>
                                    <td>{{ form.tempo_alternancia }}</td>
                                    <td><span id="alternancia_tempo_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="alternancia_tempo_class" class="text-muted fst-italic"></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Contagem de Erros -->
                    <h5 class="mb-3 fw-normal">Contagem de Erros</h5>
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 25%;">Etapa</th>
                                    <th style="width: 25%;">Erros</th>
                                    <th style="width: 25%;">Percentil</th>
                                    <th style="width: 25%;">Classificação</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Leitura</td>
                                    <td>{{ form.erro_leitura }}</td>
                                    <td><span id="leitura_erro_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="leitura_erro_class" class="text-muted fst-italic"></span></td>
                                </tr>
                                <tr>
                                    <td>Contagem</td>
                                    <td>{{ form.erro_contagem }}</td>
                                    <td><span id="contagem_erro_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="contagem_erro_class" class="text-muted fst-italic"></span></td>
                                </tr>
                                <tr>
                                    <td>Escolha</td>
                                    <td>{{ form.erro_escolha }}</td>
                                    <td><span id="escolha_erro_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="escolha_erro_class" class="text-muted fst-italic"></span></td>
                                </tr>
                                <tr>
                                    <td>Alternância</td>
                                    <td>{{ form.erro_alternancia }}</td>
                                    <td><span id="alternancia_erro_pc" class="text-muted fst-italic"></span></td>
                                    <td><span id="alternancia_erro_class" class="text-muted fst-italic"></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-2"></i>Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Salvar Resultado
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Seu JavaScript existente para validação e preenchimento da data pode ser mantido.
    // O próximo passo será adicionar aqui a lógica para, ao digitar um valor,
    // calcular e preencher os campos de Percentil e Classificação (os <span>).
});
</script>
{% endblock %}
